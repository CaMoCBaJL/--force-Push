#pragma checksum "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "bc5020f92381e8d119a4b9c6d025ecc6365ec700"
// <auto-generated/>
#pragma warning disable 1591
namespace MySiteServer.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\_Imports.razor"
using MySiteServer;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\_Imports.razor"
using MySiteServer.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
using System.Text;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
using System.IO;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/goods")]
    public partial class Goods : IndexBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
#nullable restore
#line 9 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
 for (int i = 0; i < goods.Count(); i++)
{
    var j = i;

#line default
#line hidden
#nullable disable
            __builder.OpenElement(0, "p");
            __builder.OpenElement(1, "h6");
            __builder.OpenElement(2, "img");
            __builder.AddAttribute(3, "src", "/Images/" + (
#nullable restore
#line 14 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
                           imgFiles[j]

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(4, "width", "200");
            __builder.AddAttribute(5, "height", "200");
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(6, "\r\n    ");
            __builder.OpenElement(7, "a");
            __builder.AddAttribute(8, "href", "goodInfo/" + (
#nullable restore
#line 16 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
                       j

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(9, 
#nullable restore
#line 17 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
         goods.ElementAt(j).GoodName

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(10, "\r\n    ");
            __builder.OpenElement(11, "a");
            __builder.AddAttribute(12, "href", "prodInfo/" + (
#nullable restore
#line 19 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
                       j

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(13, 
#nullable restore
#line 20 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
         producers.ElementAt(@goods.ElementAt(j).GoodProducerId - 1).ProducerName

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(14, "\r\n    <h6></h6>\r\n    ");
            __builder.OpenElement(15, "h6");
            __builder.AddMarkupContent(16, " Цена - ");
            __builder.AddContent(17, 
#nullable restore
#line 24 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
                 goods.ElementAt(j).GoodPrice

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
#nullable restore
#line 25 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
     if (goods.ElementAt(j).GoodStackAmount > 0)
    {

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(18, "<h6> Есть в наличии</h6>");
#nullable restore
#line 28 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
    }
    else
    {

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(19, "<h6> Нет в наличии</h6>");
#nullable restore
#line 32 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
    }

#line default
#line hidden
#nullable disable
#nullable restore
#line 34 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
     if (user != null)
    {
        

#line default
#line hidden
#nullable disable
#nullable restore
#line 36 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
         if (!user.IsAdmin)
        {

#line default
#line hidden
#nullable disable
            __builder.OpenElement(20, "h5");
            __builder.OpenElement(21, "button");
            __builder.AddAttribute(22, "class", "button1");
            __builder.AddAttribute(23, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 39 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
                                                  () => AddGoodToCart(j)

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(24, " + ");
            __builder.CloseElement();
            __builder.AddMarkupContent(25, "\r\n                ");
            __builder.OpenElement(26, "button");
            __builder.AddAttribute(27, "class", "button0");
            __builder.AddAttribute(28, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 40 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
                                                  () => RemoveGoodFromCart(j)

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(29, " - ");
            __builder.CloseElement();
            __builder.AddMarkupContent(30, "\r\n\r\n                ");
            __builder.OpenElement(31, "input");
            __builder.AddAttribute(32, "width", "50");
            __builder.AddAttribute(33, "value", Microsoft.AspNetCore.Components.BindConverter.FormatValue(
#nullable restore
#line 42 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
                               inputValues[j]

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(34, "onchange", Microsoft.AspNetCore.Components.EventCallback.Factory.CreateBinder(this, __value => inputValues[j] = __value, inputValues[j]));
            __builder.SetUpdatesAttributeName("value");
            __builder.CloseElement();
            __builder.AddMarkupContent(35, " В корзине - ");
            __builder.AddContent(36, 
#nullable restore
#line 42 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
                                                                          ShowGoodAmount(j)

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
#nullable restore
#line 44 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
        }

#line default
#line hidden
#nullable disable
#nullable restore
#line 44 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
         
    }

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
#nullable restore
#line 48 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
}

#line default
#line hidden
#nullable disable
#nullable restore
#line 49 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
 if (user != null)
    

#line default
#line hidden
#nullable disable
#nullable restore
#line 50 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
     if (user.IsAdmin)
    {

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(37, "<p><div class=\" add_buttons_style\"><form action=\"goodInfo/newPage\"><button class=\"button1\"> Добавить товар</button></form>\r\n        <form action=\"goodInfo/newProducer\"><button class=\"button1\"> Добавить производителя</button></form></div></p>");
#nullable restore
#line 62 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
        }

#line default
#line hidden
#nullable disable
        }
        #pragma warning restore 1998
#nullable restore
#line 64 "C:\Users\Анотон\source\repos\MySiteServer\MySiteServer\Pages\Goods.razor"
       
    private User user;
    private IEnumerable<Good> goods = new List<Good>();
    private IEnumerable<Producer> producers = new List<Producer>();
    private List<uint> inputValues;
    private List<string> imgFiles;

    protected override void OnInitialized()
    {
        goods = repository.GetAllGoods();
        producers = repository.GetAllProducers();
        imgFiles = new List<string>();
        foreach (var item in new DirectoryInfo("./wwwroot/Images").GetFiles())
        {
            imgFiles.Add(item.Name);
        }
        if (!string.IsNullOrEmpty(Service.userName) && !string.IsNullOrWhiteSpace(Service.password))
            foreach (User u in repository.GetAllUsers())
                if (u.L0gin == Service.userName && u.Passwrd == Service.password)
                    user = u;
        inputValues = new List<uint>();
        for (int i = 0; i < goods.Count(); i++)
        {
            inputValues.Add(1);
        }
    }


    private uint ShowGoodAmount(int goodNum)
    {
        if (user.UserCart != null)
        {
            uint result = 0;
            foreach (var item in user.UserCart.Split())
            {
                string s = goodNum.ToString() + "*";
                string c;
                if (item.Contains(s))
                {
                    c = item.Substring(s.Length, item.Length - s.Length);
                    uint.TryParse(c, out result);
                    return result;
                }
            }
            return 0;
        }
        else
            return 0;
    }

    private void RemoveGoodFromCart(int goodNum)
    {
        if (!string.IsNullOrEmpty(user.UserCart))
        {
            string s = (goodNum.ToString() + '*').ToString();
            if (user.UserCart.Contains(s))
            {
                StringBuilder result = new StringBuilder();
                user.UserCart.Split().Cast<string>().ToList().ForEach(new Action<string>((str) =>
                {
                    if (str.Contains(s))
                    {
                        int newValue = int.Parse(str.Substring(s.Length, str.Length - s.Length)) - (int)inputValues[goodNum];
                        if (newValue > 0)
                            str = str.Substring(0, s.Length) + newValue.ToString();
                    }

                    result.Append(str + " ");
                }));
                user.UserCart = result.Remove(result.Length - 1, 1).ToString();
                repository.UserInfoChanged(user);
            }
        }
    }

    private void AddGoodToCart(int goodNum)
    {
        if (!string.IsNullOrEmpty(user.UserCart))
        {
            string s = goodNum.ToString() + "*";
            if (user.UserCart.Contains(s))
            {
                StringBuilder result = new StringBuilder();
                user.UserCart.Split().Cast<string>().ToList().ForEach(new Action<string>((str) =>
                {
                    if (str.Contains(s))
                        str = str.Substring(0, s.Length) + (int.Parse(str.Substring(s.Length, str.Length - s.Length)) + inputValues[goodNum]).ToString();

                    result.Append(str + " ");
                }));
                user.UserCart = result.Remove(result.Length - 1, 1).ToString();
            }
            else
                user.UserCart = (new StringBuilder(user.UserCart).Append(' ' + goodNum.ToString() + '*' + inputValues[goodNum])).ToString();
        }
        else
            user.UserCart = (goodNum.ToString() + '*' + inputValues[goodNum]).ToString();
        repository.UserInfoChanged(user);
    }

    public string ImgNum(int i)
    {
        return i.ToString() + ".jpg";
    }



#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private MySiteServer.Data.Repository.IRepository repository { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager NavigationManager { get; set; }
    }
}
#pragma warning restore 1591
